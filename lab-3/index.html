
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="IBM Developer">
      
      
        <link rel="canonical" href="https://ibm.github.io/presto-hudi-workshop/lab-3/">
      
      
        <link rel="prev" href="../lab-2/">
      
      
        <link rel="next" href="../resources/RESOURCES/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.16">
    
    
      
        <title>Lab 3. Explore Hudi Table & Query Types - Presto-Hudi Workshop</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.7e37652d.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=IBM+Plex+Sans:300,300i,400,400i,700,700i%7CIBM+Plex+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"IBM Plex Sans";--md-code-font:"IBM Plex Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Lab 3. Explore Hudi Table & Query Types - Presto-Hudi Workshop" >
      
        <meta  property="og:description"  content="None" >
      
        <meta  property="og:image"  content="https://ibm.github.io/presto-hudi-workshop/assets/images/social/lab-3/README.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://ibm.github.io/presto-hudi-workshop/lab-3/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Lab 3. Explore Hudi Table & Query Types - Presto-Hudi Workshop" >
      
        <meta  name="twitter:description"  content="None" >
      
        <meta  name="twitter:image"  content="https://ibm.github.io/presto-hudi-workshop/assets/images/social/lab-3/README.png" >
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="blue">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#explore-hudi-table-query-types" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Presto-Hudi Workshop" class="md-header__button md-logo" aria-label="Presto-Hudi Workshop" data-md-component="logo">
      
  <img src="../images/ibm-blue-background.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Presto-Hudi Workshop
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Lab 3. Explore Hudi Table & Query Types
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/IBM/presto-hudi-workshop.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    presto-hudi-workshop
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
  Welcome

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../pre-work/" class="md-tabs__link">
          
  
  
  Workshop

        </a>
      </li>
    
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../resources/RESOURCES/" class="md-tabs__link">
          
  
  
  References

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Presto-Hudi Workshop" class="md-nav__button md-logo" aria-label="Presto-Hudi Workshop" data-md-component="logo">
      
  <img src="../images/ibm-blue-background.png" alt="logo">

    </a>
    Presto-Hudi Workshop
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/IBM/presto-hudi-workshop.git" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    presto-hudi-workshop
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          <label class="md-nav__link" for="__nav_1" id="__nav_1_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Welcome
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            Welcome
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    About the workshop
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="">
            
  
  
  <span class="md-ellipsis">
    Workshop
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Workshop
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../pre-work/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 0. Pre-work
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-1/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 1. Set up an Open Lakehouse
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../lab-2/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Lab 2. Create and Query Basic Hudi Tables
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    Lab 3. Explore Hudi Table & Query Types
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    Lab 3. Explore Hudi Table & Query Types
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-mor-hudi-table" class="md-nav__link">
    <span class="md-ellipsis">
      1. Create MoR Hudi table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-query-mor-table-with-presto" class="md-nav__link">
    <span class="md-ellipsis">
      2. Query MoR table with Presto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-add-data-to-mor-table-and-query" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add data to MoR table and query
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-partitioned-cow-hudi-table" class="md-nav__link">
    <span class="md-ellipsis">
      4. Create partitioned CoW Hudi table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-query-cow-table-with-presto" class="md-nav__link">
    <span class="md-ellipsis">
      5. Query CoW table with Presto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Query CoW table with Presto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    References
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            References
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/RESOURCES/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Additional Resources
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/CONTRIBUTORS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/MKDOCS/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    MkDocs Cheatsheet
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../resources/ADMIN/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Admin Guide
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#1-create-mor-hudi-table" class="md-nav__link">
    <span class="md-ellipsis">
      1. Create MoR Hudi table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#2-query-mor-table-with-presto" class="md-nav__link">
    <span class="md-ellipsis">
      2. Query MoR table with Presto
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-add-data-to-mor-table-and-query" class="md-nav__link">
    <span class="md-ellipsis">
      3. Add data to MoR table and query
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-create-partitioned-cow-hudi-table" class="md-nav__link">
    <span class="md-ellipsis">
      4. Create partitioned CoW Hudi table
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-query-cow-table-with-presto" class="md-nav__link">
    <span class="md-ellipsis">
      5. Query CoW table with Presto
    </span>
  </a>
  
    <nav class="md-nav" aria-label="5. Query CoW table with Presto">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#shutdown" class="md-nav__link">
    <span class="md-ellipsis">
      Shutdown
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="explore-hudi-table-query-types">Explore Hudi Table &amp; Query Types<a class="headerlink" href="#explore-hudi-table-query-types" title="Permanent link">&para;</a></h1>
<p>In this section, you will create different types of Hudi tables with Spark and query them with Presto.</p>
<p>This section is comprised of the following steps:</p>
<ul>
<li><a href="#explore-hudi-table--query-types">Explore Hudi Table \&amp; Query Types</a></li>
<li><a href="#1-create-mor-hudi-table">1. Create MoR Hudi table</a></li>
<li><a href="#2-query-mor-table-with-presto">2. Query MoR table with Presto</a></li>
<li><a href="#3-add-data-to-mor-table-and-query">3. Add data to MoR table and query</a></li>
<li><a href="#4-create-partitioned-cow-hudi-table">4. Create partitioned CoW Hudi table</a></li>
<li><a href="#5-query-cow-table-with-presto">5. Query CoW table with Presto</a><ul>
<li><a href="#shutdown">Shutdown</a></li>
</ul>
</li>
</ul>
<p>If you previously stopped your lakehouse containers, restart them now with:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>up<span class="w"> </span>-d
</span></code></pre></div>
<h2 id="1-create-mor-hudi-table">1. Create MoR Hudi table<a class="headerlink" href="#1-create-mor-hudi-table" title="Permanent link">&para;</a></h2>
<p>In this section we'll explore Hudi Merge-on-Read (MoR) tables. MoR tables store data using file versions with combination of columnar (e.g parquet) + row based (e.g avro) file formats. Updates are logged to delta files &amp; later compacted to produce new versions of columnar files synchronously or asynchronously. Currently, it is not possible to create Hudi tables from Presto, so we will use Spark to create our tables. To do so, we'll enter the Spark container and start the <code>spark-shell</code>:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>spark<span class="w"> </span>/opt/spark/bin/spark-shell
</span></code></pre></div>
<p>It may take a few moments to initialize before you see the <code>scala&gt;</code> prompt, indicating that the shell is ready to accept commands. Enter "paste" mode by typing the following and pressing enter:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a>:paste
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>scala&gt;<span class="w"> </span>:paste
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a>//<span class="w"> </span>Entering<span class="w"> </span>paste<span class="w"> </span>mode<span class="w"> </span><span class="o">(</span>ctrl-D<span class="w"> </span>to<span class="w"> </span>finish<span class="o">)</span>
</span></code></pre></div>
<p>Copy and paste the below code, which imports required packages, creates a Spark session, and defines some variables that we will reference in subsequent code.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: you do not need to copy/paste the below code if you completed lab 2 and have not restarted your <code>spark-shell</code>, but, regardless, doing so should be harmless.</p>
</div>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.{</span><span class="nc">SparkSession</span><span class="p">,</span><span class="w"> </span><span class="nc">SaveMode</span><span class="p">}</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="k">import</span><span class="w"> </span><span class="nn">scala</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">Random</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="k">import</span><span class="w"> </span><span class="nn">java</span><span class="p">.</span><span class="nn">util</span><span class="p">.</span><span class="nc">UUID</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">spark</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">SparkSession</span><span class="p">.</span><span class="n">builder</span><span class="p">()</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a><span class="w">  </span><span class="p">.</span><span class="n">appName</span><span class="p">(</span><span class="s">&quot;HudiToMinIO&quot;</span><span class="p">)</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.serializer&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.spark.serializer.KryoSerializer&quot;</span><span class="p">)</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.sql.catalogImplementation&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;hive&quot;</span><span class="p">)</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;hive.metastore.uris&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;thrift://hive-metastore:9083&quot;</span><span class="p">)</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.sql.hive.convertMetastoreParquet&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.endpoint&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;http://minio:9000&quot;</span><span class="p">)</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.access.key&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;minio&quot;</span><span class="p">)</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.secret.key&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;minio123&quot;</span><span class="p">)</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.path.style.access&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">)</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.impl&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;org.apache.hadoop.fs.s3a.S3AFileSystem&quot;</span><span class="p">)</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="p">.</span><span class="n">config</span><span class="p">(</span><span class="s">&quot;spark.hadoop.fs.s3a.connection.ssl.enabled&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;false&quot;</span><span class="p">)</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="p">.</span><span class="n">enableHiveSupport</span><span class="p">()</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span><span class="p">.</span><span class="n">getOrCreate</span><span class="p">()</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="k">import</span><span class="w"> </span><span class="nn">spark</span><span class="p">.</span><span class="nn">implicits</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">hudi</span><span class="p">.</span><span class="nc">QuickstartUtils</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="k">import</span><span class="w"> </span><span class="nn">scala</span><span class="p">.</span><span class="nn">collection</span><span class="p">.</span><span class="nc">JavaConversions</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">spark</span><span class="p">.</span><span class="nn">sql</span><span class="p">.</span><span class="nc">SaveMode</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">hudi</span><span class="p">.</span><span class="nc">DataSourceReadOptions</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">hudi</span><span class="p">.</span><span class="nc">DataSourceWriteOptions</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="k">import</span><span class="w"> </span><span class="nn">org</span><span class="p">.</span><span class="nn">apache</span><span class="p">.</span><span class="nn">hudi</span><span class="p">.</span><span class="nn">config</span><span class="p">.</span><span class="nc">HoodieWriteConfig</span><span class="p">.</span><span class="n">_</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="kd">val</span><span class="w"> </span><span class="n">basePath</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;s3a://warehouse/hudi-tables&quot;</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="kd">val</span><span class="w"> </span><span class="n">dbName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;default&quot;</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="k">def</span><span class="w"> </span><span class="nf">hudiOptions</span><span class="p">(</span><span class="n">tableName</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">tableType</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">precombineField</span><span class="p">:</span><span class="w"> </span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="n">partitionField</span><span class="p">:</span><span class="w"> </span><span class="nc">Option</span><span class="p">[</span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">None</span><span class="p">):</span><span class="w"> </span><span class="nc">Map</span><span class="p">[</span><span class="nc">String</span><span class="p">,</span><span class="w"> </span><span class="nc">String</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">  </span><span class="nc">Map</span><span class="p">(</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">    </span><span class="s">&quot;hoodie.table.name&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.recordkey.field&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;uuid&quot;</span><span class="p">,</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.precombine.field&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">precombineField</span><span class="p">,</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.table.name&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.operation&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;upsert&quot;</span><span class="p">,</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.table.type&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tableType</span><span class="p">,</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.write.hive_style_partitioning&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.hive_sync.enable&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">,</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.hive_sync.mode&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="s">&quot;hms&quot;</span><span class="p">,</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.hive_sync.database&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">dbName</span><span class="p">,</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">    </span><span class="s">&quot;hoodie.datasource.hive_sync.table&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">tableName</span><span class="p">,</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="w">  </span><span class="p">)</span><span class="w"> </span><span class="o">++</span><span class="w"> </span><span class="n">partitionField</span><span class="p">.</span><span class="n">map</span><span class="p">(</span><span class="n">f</span><span class="w"> </span><span class="o">=&gt;</span><span class="w"> </span><span class="nc">Map</span><span class="p">(</span><span class="s">&quot;hoodie.datasource.write.partitionpath.field&quot;</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="n">f</span><span class="p">)).</span><span class="n">getOrElse</span><span class="p">(</span><span class="nc">Map</span><span class="p">.</span><span class="n">empty</span><span class="p">)</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="p">}</span>
</span></code></pre></div>
<p>Make sure you include a newline character at the very end. Press <code>Ctrl+D</code> to begin executing the pasted code.</p>
<p>We will complete the same process with our next code block, which will create and populate our MoR table with randomly generated data about taxi trips. Notice that we are including an extra column, <code>commit_num</code> that will show us the commit in which any given row was added.</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">dataGen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="nc">DataGenerator</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">inserts</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convertToStringList</span><span class="p">(</span><span class="n">dataGen</span><span class="p">.</span><span class="n">generateInserts</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">inserts</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">))</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="kd">val</span><span class="w"> </span><span class="n">morTableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;mor_trips_table&quot;</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="n">data</span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&quot;commit_num&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="s">&quot;update1&quot;</span><span class="p">)).</span><span class="n">write</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;hudi&quot;</span><span class="p">).</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">getQuickstartWriteConfigs</span><span class="p">).</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">hudiOptions</span><span class="p">(</span><span class="n">morTableName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MERGE_ON_READ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ts&quot;</span><span class="p">)).</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">    </span><span class="n">mode</span><span class="p">(</span><span class="nc">Overwrite</span><span class="p">).</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="n">save</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">$</span><span class="n">basePath</span><span class="s">/</span><span class="si">$</span><span class="n">morTableName</span><span class="s">&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Before we go on to query these tables, let's take a look at what files and directories have been created for this table in our s3 storage. Go to MinIO UI <a href="http://localhost:9091">http://localhost:9091</a> and log in with the username and password that we defined in <code>docker-compose.yaml</code> (<code>minio</code>/<code>minio123</code>). Under the <code>hudi-tables</code> path, there should be a sub-path called <code>mor_trips_table</code>. Click into this path and explore the created files and directory structure, especially those in the <code>.hoodie</code> directory. This is where Hudi keeps metadata for the <code>mor_trips_table</code>. We can see that there is one set of <code>deltacommit</code> files created to keep track of the initial data we've inserted into the table.</p>
<p><img alt="MoR metadata directory" src="../images/mor_dirs.png" /></p>
<h2 id="2-query-mor-table-with-presto">2. Query MoR table with Presto<a class="headerlink" href="#2-query-mor-table-with-presto" title="Permanent link">&para;</a></h2>
<p>Now let's query these tables with Presto. In a new terminal tab or window, exec into the Presto container and start the Presto CLI to query our table.</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="w"> </span>docker<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>coordinator<span class="w"> </span>presto-cli
</span></code></pre></div>
<p>We first specify that we want to use the Hudi catalog and <code>default</code> schema for all queries here on out. Then, execute a <code>show tables</code> command:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="n">use</span><span class="w"> </span><span class="n">hudi</span><span class="p">.</span><span class="k">default</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>presto&gt;<span class="w"> </span>use<span class="w"> </span>hudi.default<span class="p">;</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>USE
</span></code></pre></div>
<p>Next, list the available tables:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>presto:default&gt;<span class="w"> </span>show<span class="w"> </span>tables<span class="p">;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">       </span>Table<span class="w">        </span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>--------------------
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="w"> </span>mor_trips_table_ro<span class="w"> </span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a><span class="w"> </span>mor_trips_table_rt<span class="w"> </span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w"> </span>trips_table<span class="w">        </span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="o">(</span><span class="m">3</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may not have the <code>trips_table</code> depending on when you completed lab 2 and if you shut down or restarted your lakehouse cluster.</p>
</div>
<p>Notice how Hudi is implicity showing us two versions of the MoR table - one suffixed with <code>_ro</code> for "read-optimized" and one suffixed with <code>_rt</code> for "real-time". As expected, each provides a different view. Right now, querying them shows the same information since we've only inserted data into the table once at time of creation. Run the below query on both tables to verify this.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">commit_num</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">fare</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lon</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lat</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">mor_trips_table_ro</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>commit_num,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>fare,<span class="w"> </span>begin_lon,<span class="w"> </span>begin_lat<span class="w"> </span>from<span class="w"> </span>mor_trips_table_ro<span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span>_hoodie_commit_time<span class="p">;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>commit_num<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">        </span>fare<span class="w">        </span><span class="p">|</span><span class="w">      </span>begin_lon<span class="w">      </span><span class="p">|</span><span class="w">      </span>begin_lat<span class="w">      </span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>---------------------+------------+----------------------------------------------------------------------------+--------------------+---------------------+---------------------
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">60</span>.34776367964548<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.04838041157380535<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.8043080489965999<span class="w"> </span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">77</span>.87647707179<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.48628479602261987<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5108935227213224<span class="w"> </span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">92</span>.66658188648728<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.19250097971954727<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.29883236260196766<span class="w"> </span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">87</span>.60866855274442<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.7072482413115851<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4050368427403227<span class="w"> </span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">2</span>.542602090419077<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.32513116973946665<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5223409231279434<span class="w"> </span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">64</span>.50549995709942<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.644801818366808<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.27416484281668874<span class="w"> </span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">87</span>.90342171962<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6392049453784305<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.988424424914435<span class="w"> </span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">4</span>.683013253665058<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.9524155201748359<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5358882850214233<span class="w"> </span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">52</span>.45373021236392<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.16908935729553864<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5977389933638982<span class="w"> </span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">63</span>.153644129279854<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.08661048702300178<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.3591754879402138<span class="w"> </span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<h2 id="3-add-data-to-mor-table-and-query">3. Add data to MoR table and query<a class="headerlink" href="#3-add-data-to-mor-table-and-query" title="Permanent link">&para;</a></h2>
<p>Now, let's go back to our <code>spark-shell</code> terminal tab and add more data to our tables using paste mode. Note that our <code>commit_num</code> column value has changed.</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">updates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convertToStringList</span><span class="p">(</span><span class="n">dataGen</span><span class="p">.</span><span class="n">generateUpdates</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">updatedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">updates</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="n">updatedData</span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&quot;commit_num&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="s">&quot;update2&quot;</span><span class="p">)).</span><span class="n">write</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;hudi&quot;</span><span class="p">).</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">getQuickstartWriteConfigs</span><span class="p">).</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">hudiOptions</span><span class="p">(</span><span class="n">morTableName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MERGE_ON_READ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ts&quot;</span><span class="p">)).</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="n">mode</span><span class="p">(</span><span class="nc">Append</span><span class="p">).</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="w">    </span><span class="n">save</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">$</span><span class="n">basePath</span><span class="s">/</span><span class="si">$</span><span class="n">morTableName</span><span class="s">&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Now if we query the tables in the Presto CLI, we see that the MoR <code>RO</code> ("read-optimized") and <code>RT</code> ("real-time") tables are starting to look different. As you can guess by the names, the RT table has the freshest data, and the RO table still shows our previous state.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">commit_num</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">fare</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lon</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lat</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">mor_trips_table_rt</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>commit_num,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>fare,<span class="w"> </span>begin_lon,<span class="w"> </span>begin_lat<span class="w"> </span>from<span class="w"> </span>mor_trips_table_rt<span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span>_hoodie_commit_time<span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>commit_num<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">        </span>fare<span class="w">        </span><span class="p">|</span><span class="w">      </span>begin_lon<span class="w">      </span><span class="p">|</span><span class="w">      </span>begin_lat<span class="w">      </span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a>---------------------+------------+----------------------------------------------------------------------------+--------------------+---------------------+---------------------
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">92</span>.66658188648728<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.19250097971954727<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.29883236260196766<span class="w"> </span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">77</span>.87647707179<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.48628479602261987<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5108935227213224<span class="w"> </span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">87</span>.60866855274442<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.7072482413115851<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4050368427403227<span class="w"> </span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">2</span>.542602090419077<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.32513116973946665<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5223409231279434<span class="w"> </span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">87</span>.90342171962<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6392049453784305<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.988424424914435<span class="w"> </span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">52</span>.45373021236392<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.16908935729553864<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5977389933638982<span class="w"> </span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0<span class="w">                                     </span><span class="p">|</span><span class="w">   </span><span class="m">99</span>.1562254763212<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6294358584439047<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.8543808877516004<span class="w"> </span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0<span class="w">                                     </span><span class="p">|</span><span class="w">  </span><span class="m">97</span>.86876579077843<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.895279012685712<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.2650495107524782<span class="w"> </span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0<span class="w">                                     </span><span class="p">|</span><span class="w"> </span><span class="m">15</span>.893431524875934<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.22687250146427174<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.01766360374572995<span class="w"> </span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0<span class="w">                                     </span><span class="p">|</span><span class="w">  </span><span class="m">11</span>.38881031161545<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.8233625060614379<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.912094209732618<span class="w"> </span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<p>And</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">commit_num</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">fare</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lon</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lat</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">mor_trips_table_ro</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>commit_num,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>fare,<span class="w"> </span>begin_lon,<span class="w"> </span>begin_lat<span class="w"> </span>from<span class="w"> </span>mor_trips_table_ro<span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span>_hoodie_commit_time<span class="p">;</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>commit_num<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">        </span>fare<span class="w">        </span><span class="p">|</span><span class="w">      </span>begin_lon<span class="w">      </span><span class="p">|</span><span class="w">      </span>begin_lat<span class="w">      </span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>---------------------+------------+----------------------------------------------------------------------------+--------------------+---------------------+---------------------
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">4</span>.683013253665058<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.9524155201748359<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5358882850214233<span class="w"> </span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#__codelineno-17-5"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">60</span>.34776367964548<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.04838041157380535<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.8043080489965999<span class="w"> </span>
</span><span id="__span-17-6"><a id="__codelineno-17-6" name="__codelineno-17-6" href="#__codelineno-17-6"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">92</span>.66658188648728<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.19250097971954727<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.29883236260196766<span class="w"> </span>
</span><span id="__span-17-7"><a id="__codelineno-17-7" name="__codelineno-17-7" href="#__codelineno-17-7"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">2</span>.542602090419077<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.32513116973946665<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5223409231279434<span class="w"> </span>
</span><span id="__span-17-8"><a id="__codelineno-17-8" name="__codelineno-17-8" href="#__codelineno-17-8"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">87</span>.90342171962<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6392049453784305<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.988424424914435<span class="w"> </span>
</span><span id="__span-17-9"><a id="__codelineno-17-9" name="__codelineno-17-9" href="#__codelineno-17-9"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">52</span>.45373021236392<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.16908935729553864<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5977389933638982<span class="w"> </span>
</span><span id="__span-17-10"><a id="__codelineno-17-10" name="__codelineno-17-10" href="#__codelineno-17-10"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">63</span>.153644129279854<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.08661048702300178<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.3591754879402138<span class="w"> </span>
</span><span id="__span-17-11"><a id="__codelineno-17-11" name="__codelineno-17-11" href="#__codelineno-17-11"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">     </span><span class="m">77</span>.87647707179<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.48628479602261987<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.5108935227213224<span class="w"> </span>
</span><span id="__span-17-12"><a id="__codelineno-17-12" name="__codelineno-17-12" href="#__codelineno-17-12"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">87</span>.60866855274442<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.7072482413115851<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4050368427403227<span class="w"> </span>
</span><span id="__span-17-13"><a id="__codelineno-17-13" name="__codelineno-17-13" href="#__codelineno-17-13"></a><span class="w"> </span><span class="m">20250729021205937</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update1<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-256-264_20250729021205937.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">64</span>.50549995709942<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.644801818366808<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.27416484281668874<span class="w"> </span>
</span><span id="__span-17-14"><a id="__codelineno-17-14" name="__codelineno-17-14" href="#__codelineno-17-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<p>We can also look in the MinIO UI again to see the different files that have been created. Notice in the <code>.hoodie</code> path that we have two sets of <code>deltacommit</code> files</p>
<p><img alt="MoR table update" src="../images/mor_dirs2.png" /></p>
<p>We can also see, from the main <code>mor_trips_table</code> path, that we have log files. This is where Hudi stores the data that has been inserted since our table was created.</p>
<p><img alt="MoR log files" src="../images/mor_log.png" /></p>
<p>Let's add data in the <code>spark-shell</code> one more time, this time specifying that we want to compact the MoR table after the second commit. This means that both the changes made in this operation and in the previous "insert" operation will be made "final".</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#__codelineno-18-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">moreUpdates</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">convertToStringList</span><span class="p">(</span><span class="n">dataGen</span><span class="p">.</span><span class="n">generateUpdates</span><span class="p">(</span><span class="mi">100</span><span class="p">))</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#__codelineno-18-2"></a><span class="kd">val</span><span class="w"> </span><span class="n">moreUpdatedData</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">spark</span><span class="p">.</span><span class="n">read</span><span class="p">.</span><span class="n">json</span><span class="p">(</span><span class="n">spark</span><span class="p">.</span><span class="n">sparkContext</span><span class="p">.</span><span class="n">parallelize</span><span class="p">(</span><span class="n">moreUpdates</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p">));</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#__codelineno-18-4"></a><span class="n">moreUpdatedData</span><span class="p">.</span><span class="n">withColumn</span><span class="p">(</span><span class="s">&quot;commit_num&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">lit</span><span class="p">(</span><span class="s">&quot;update3&quot;</span><span class="p">)).</span><span class="n">write</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;hudi&quot;</span><span class="p">).</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#__codelineno-18-5"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">getQuickstartWriteConfigs</span><span class="p">).</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#__codelineno-18-6"></a><span class="w">    </span><span class="n">options</span><span class="p">(</span><span class="n">hudiOptions</span><span class="p">(</span><span class="n">morTableName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;MERGE_ON_READ&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ts&quot;</span><span class="p">)).</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#__codelineno-18-7"></a><span class="w">    </span><span class="n">option</span><span class="p">(</span><span class="s">&quot;hoodie.compact.inline&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;true&quot;</span><span class="p">).</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#__codelineno-18-8"></a><span class="w">    </span><span class="n">option</span><span class="p">(</span><span class="s">&quot;hoodie.compact.inline.max.delta.commits&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="p">).</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#__codelineno-18-9"></a><span class="w">    </span><span class="n">mode</span><span class="p">(</span><span class="nc">Append</span><span class="p">).</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#__codelineno-18-10"></a><span class="w">    </span><span class="n">save</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">$</span><span class="n">basePath</span><span class="s">/</span><span class="si">$</span><span class="n">morTableName</span><span class="s">&quot;</span><span class="p">);</span>
</span></code></pre></div>
<p>Now when we query both tables in the Presto CLI, we see that the RO and RT MoR tables are once again in line.</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#__codelineno-19-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">commit_num</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">fare</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lon</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lat</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">mor_trips_table_rt</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#__codelineno-20-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>commit_num,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>fare,<span class="w"> </span>begin_lon,<span class="w"> </span>begin_lat<span class="w"> </span>from<span class="w"> </span>mor_trips_table_rt<span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span>_hoodie_commit_time<span class="p">;</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#__codelineno-20-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>commit_num<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">        </span>fare<span class="w">        </span><span class="p">|</span><span class="w">      </span>begin_lon<span class="w">       </span><span class="p">|</span><span class="w">      </span>begin_lat<span class="w">      </span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#__codelineno-20-3"></a>---------------------+------------+----------------------------------------------------------------------------+--------------------+----------------------+---------------------
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#__codelineno-20-4"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">15</span>.893431524875934<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.22687250146427174<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.01766360374572995<span class="w"> </span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#__codelineno-20-5"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">83</span>.72026345530593<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.9215019802670729<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.3342282415053993<span class="w"> </span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#__codelineno-20-6"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">70</span>.75181768700271<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.729623028385541<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.7839574214459966<span class="w"> </span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#__codelineno-20-7"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">9</span>.768372582023833<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.4207368731538873<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.12793027848861438<span class="w"> </span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#__codelineno-20-8"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">16</span>.883429270325678<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.06563367485824312<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.10377660872667782<span class="w"> </span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#__codelineno-20-9"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">60</span>.2809650191646<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.8928407027516947<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.35471878303496784<span class="w"> </span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#__codelineno-20-10"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">30</span>.06619331487149<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.2676792805368092<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4255539475116672<span class="w"> </span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#__codelineno-20-11"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">88</span>.05938803140756<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.015739965020097335<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.9567504820036522<span class="w"> </span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#__codelineno-20-12"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">60</span>.56303585997367<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.2315469742599775<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4746664494938815<span class="w"> </span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#__codelineno-20-13"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">71</span>.6883114598098<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.9559151875258244<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6027024841832427<span class="w"> </span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#__codelineno-20-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<p>And</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#__codelineno-21-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">commit_num</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">fare</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lon</span><span class="p">,</span><span class="w"> </span><span class="n">begin_lat</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">mor_trips_table_ro</span><span class="w"> </span><span class="k">order</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#__codelineno-22-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>commit_num,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>fare,<span class="w"> </span>begin_lon,<span class="w"> </span>begin_lat<span class="w"> </span>from<span class="w"> </span>mor_trips_table_ro<span class="w"> </span>order<span class="w"> </span>by<span class="w"> </span>_hoodie_commit_time<span class="p">;</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#__codelineno-22-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>commit_num<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">        </span>fare<span class="w">        </span><span class="p">|</span><span class="w">      </span>begin_lon<span class="w">       </span><span class="p">|</span><span class="w">      </span>begin_lat<span class="w">      </span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#__codelineno-22-3"></a>---------------------+------------+----------------------------------------------------------------------------+--------------------+----------------------+---------------------
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#__codelineno-22-4"></a><span class="w"> </span><span class="m">20250729021301565</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update2<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">15</span>.893431524875934<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.22687250146427174<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.01766360374572995<span class="w"> </span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#__codelineno-22-5"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">71</span>.6883114598098<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.9559151875258244<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.6027024841832427<span class="w"> </span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#__codelineno-22-6"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">9</span>.768372582023833<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.4207368731538873<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.12793027848861438<span class="w"> </span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#__codelineno-22-7"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">30</span>.06619331487149<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.2676792805368092<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4255539475116672<span class="w"> </span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#__codelineno-22-8"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">16</span>.883429270325678<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.06563367485824312<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.10377660872667782<span class="w"> </span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#__codelineno-22-9"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">88</span>.05938803140756<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.015739965020097335<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.9567504820036522<span class="w"> </span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#__codelineno-22-10"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">60</span>.2809650191646<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.8928407027516947<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="m">0</span>.35471878303496784<span class="w"> </span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#__codelineno-22-11"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">60</span>.56303585997367<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.2315469742599775<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.4746664494938815<span class="w"> </span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#__codelineno-22-12"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">83</span>.72026345530593<span class="w"> </span><span class="p">|</span><span class="w">   </span><span class="m">0</span>.9215019802670729<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.3342282415053993<span class="w"> </span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#__codelineno-22-13"></a><span class="w"> </span><span class="m">20250729021427840</span><span class="w">   </span><span class="p">|</span><span class="w"> </span>update3<span class="w">    </span><span class="p">|</span><span class="w"> </span>f226d78a-a109-4b0a-b9a6-e522b75c1037-0_0-324-330_20250729021428973.parquet<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">70</span>.75181768700271<span class="w"> </span><span class="p">|</span><span class="w">    </span><span class="m">0</span>.729623028385541<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">0</span>.7839574214459966<span class="w"> </span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#__codelineno-22-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<p>In the MinIO UI, we are able to see a third set of <code>deltacommit</code>s as well as the compaction commit.</p>
<p><img alt="MoR compaction" src="../images/mor_dirs3.png" /></p>
<h2 id="4-create-partitioned-cow-hudi-table">4. Create partitioned CoW Hudi table<a class="headerlink" href="#4-create-partitioned-cow-hudi-table" title="Permanent link">&para;</a></h2>
<p>In this section we'll explore Hudi partitioned Copy-on-Write (CoW) tables. CoW tables store data using exclusively columnar file formats (e.g parquet). Updates version &amp; rewrites the files by performing a synchronous merge during write. Let's create a COW table with partitions in Spark so that we can also see how partitioning changes the directory structure of our tables. From within the <code>spark-shell</code> session from the previous sections, enter the following code in paste mode:</p>
<div class="language-scala highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#__codelineno-23-1"></a><span class="kd">val</span><span class="w"> </span><span class="n">cowTableName</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;cow_trips_table&quot;</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#__codelineno-23-2"></a>
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#__codelineno-23-3"></a><span class="kd">val</span><span class="w"> </span><span class="n">countries</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Seq</span><span class="p">(</span><span class="s">&quot;US&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;IN&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;DE&quot;</span><span class="p">)</span>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#__codelineno-23-4"></a><span class="kd">val</span><span class="w"> </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="mi">1</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="mi">500</span><span class="p">).</span><span class="n">map</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=&gt;</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#__codelineno-23-5"></a><span class="w">  </span><span class="p">(</span><span class="nc">UUID</span><span class="p">.</span><span class="n">randomUUID</span><span class="p">().</span><span class="n">toString</span><span class="p">(),</span><span class="w"> </span><span class="s">s&quot;user_</span><span class="si">$</span><span class="n">i</span><span class="s">&quot;</span><span class="p">,</span><span class="w"> </span><span class="mi">20</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="nc">Random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span><span class="w"> </span><span class="n">countries</span><span class="p">(</span><span class="nc">Random</span><span class="p">.</span><span class="n">nextInt</span><span class="p">(</span><span class="n">countries</span><span class="p">.</span><span class="n">length</span><span class="p">)))</span>
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#__codelineno-23-6"></a><span class="p">}.</span><span class="n">toDF</span><span class="p">(</span><span class="s">&quot;uuid&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;name&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;country&quot;</span><span class="p">)</span>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#__codelineno-23-7"></a>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#__codelineno-23-8"></a><span class="n">data</span><span class="p">.</span><span class="n">write</span><span class="p">.</span><span class="n">format</span><span class="p">(</span><span class="s">&quot;hudi&quot;</span><span class="p">)</span>
</span><span id="__span-23-9"><a id="__codelineno-23-9" name="__codelineno-23-9" href="#__codelineno-23-9"></a><span class="w">  </span><span class="p">.</span><span class="n">options</span><span class="p">(</span><span class="n">getQuickstartWriteConfigs</span><span class="p">)</span>
</span><span id="__span-23-10"><a id="__codelineno-23-10" name="__codelineno-23-10" href="#__codelineno-23-10"></a><span class="w">  </span><span class="p">.</span><span class="n">options</span><span class="p">(</span><span class="n">hudiOptions</span><span class="p">(</span><span class="n">cowTableName</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;COPY_ON_WRITE&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;age&quot;</span><span class="p">,</span><span class="w"> </span><span class="nc">Some</span><span class="p">(</span><span class="s">&quot;country&quot;</span><span class="p">)))</span>
</span><span id="__span-23-11"><a id="__codelineno-23-11" name="__codelineno-23-11" href="#__codelineno-23-11"></a><span class="w">  </span><span class="p">.</span><span class="n">mode</span><span class="p">(</span><span class="nc">Overwrite</span><span class="p">)</span>
</span><span id="__span-23-12"><a id="__codelineno-23-12" name="__codelineno-23-12" href="#__codelineno-23-12"></a><span class="w">  </span><span class="p">.</span><span class="n">save</span><span class="p">(</span><span class="s">s&quot;</span><span class="si">$</span><span class="n">basePath</span><span class="s">/</span><span class="si">$</span><span class="n">cowTableName</span><span class="s">&quot;</span><span class="p">)</span>
</span></code></pre></div>
<p>In the MinIO UI, we can see that we now have a new table path - <code>cow_trips_table</code> - under <code>hudi_tables</code>. When we explore this path more, we can see the partition directories that have been created for this table according to our specified partition path, "country". Within each are the columnar data files that are associated with that partition.</p>
<p><img alt="CoW table partitions" src="../images/cow_dirs.png" /></p>
<p>Additionally, in the <code>.hoodie</code> directory, we can see that there is a single set of <code>commit</code> files. Notice how this differs from our MoR table, which creates <code>deltacommit</code> files.</p>
<h2 id="5-query-cow-table-with-presto">5. Query CoW table with Presto<a class="headerlink" href="#5-query-cow-table-with-presto" title="Permanent link">&para;</a></h2>
<p>From our Presto CLI tab, we can query the new table. First verify that it has synced to the Hive metastore by running a <code>show tables</code> command:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#__codelineno-24-1"></a><span class="k">show</span><span class="w"> </span><span class="n">tables</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#__codelineno-25-1"></a>presto:default&gt;<span class="w"> </span>show<span class="w"> </span>tables<span class="p">;</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#__codelineno-25-2"></a><span class="w">       </span>Table<span class="w">        </span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#__codelineno-25-3"></a>--------------------
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#__codelineno-25-4"></a><span class="w"> </span>cow_trips_table<span class="w">    </span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#__codelineno-25-5"></a><span class="w"> </span>mor_trips_table_ro<span class="w"> </span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#__codelineno-25-6"></a><span class="w"> </span>mor_trips_table_rt<span class="w"> </span>
</span><span id="__span-25-7"><a id="__codelineno-25-7" name="__codelineno-25-7" href="#__codelineno-25-7"></a><span class="w"> </span>trips_table<span class="w">        </span>
</span><span id="__span-25-8"><a id="__codelineno-25-8" name="__codelineno-25-8" href="#__codelineno-25-8"></a><span class="o">(</span><span class="m">4</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You may not have the <code>trips_table</code> depending on when you completed lab 2 and if you shut down or restarted your lakehouse cluster.</p>
</div>
<p>We can then run a <code>select</code> statement:</p>
<div class="language-sql highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#__codelineno-26-1"></a><span class="k">select</span><span class="w"> </span><span class="n">_hoodie_commit_time</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_partition_path</span><span class="p">,</span><span class="w"> </span><span class="n">_hoodie_file_name</span><span class="p">,</span><span class="w"> </span><span class="n">uuid</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">country</span><span class="w"> </span><span class="k">from</span><span class="w"> </span><span class="n">cow_trips_table</span><span class="w"> </span><span class="k">limit</span><span class="w"> </span><span class="mi">10</span><span class="p">;</span>
</span></code></pre></div>
<p>For example:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#__codelineno-27-1"></a>presto:default&gt;<span class="w"> </span><span class="k">select</span><span class="w"> </span>_hoodie_commit_time,<span class="w"> </span>_hoodie_partition_path,<span class="w"> </span>_hoodie_file_name,<span class="w"> </span>uuid,<span class="w"> </span>name,<span class="w"> </span>age,<span class="w"> </span>country<span class="w"> </span>from<span class="w"> </span>cow_trips_table<span class="w"> </span>limit<span class="w"> </span><span class="m">10</span><span class="p">;</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#__codelineno-27-2"></a><span class="w"> </span>_hoodie_commit_time<span class="w"> </span><span class="p">|</span><span class="w"> </span>_hoodie_partition_path<span class="w"> </span><span class="p">|</span><span class="w">                             </span>_hoodie_file_name<span class="w">                              </span><span class="p">|</span><span class="w">                 </span>uuid<span class="w">                 </span><span class="p">|</span><span class="w">   </span>name<span class="w">   </span><span class="p">|</span><span class="w"> </span>age<span class="w"> </span><span class="p">|</span><span class="w"> </span>country<span class="w"> </span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#__codelineno-27-3"></a>---------------------+------------------------+----------------------------------------------------------------------------+--------------------------------------+----------+-----+---------
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#__codelineno-27-4"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>f2a61600-ddcb-4deb-8692-43c6fc3c7460<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_319<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">49</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#__codelineno-27-5"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>fd13dca9-daf1-4f61-975e-21c914326347<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_7<span class="w">   </span><span class="p">|</span><span class="w">  </span><span class="m">31</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#__codelineno-27-6"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>ebe3334a-cca0-4abe-955d-dd7e9f27cfbd<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_133<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">34</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#__codelineno-27-7"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>59fd628a-eebe-436b-852f-6c248249029d<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_160<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">36</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#__codelineno-27-8"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>a0141e4a-1a23-4e92-8a5f-564d64b205d7<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_208<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">30</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#__codelineno-27-9"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>ba89f773-109f-4f8c-aebe-6aa237d39b31<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_41<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="m">45</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#__codelineno-27-10"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>01e17303-89b7-4ffc-b95f-689018acf730<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_383<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">37</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-11"><a id="__codelineno-27-11" name="__codelineno-27-11" href="#__codelineno-27-11"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>e67bcdbc-0a57-4800-a9b5-57426eb82112<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_317<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">56</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-12"><a id="__codelineno-27-12" name="__codelineno-27-12" href="#__codelineno-27-12"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>0594e246-7b62-4ddb-b442-8759864fa270<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_39<span class="w">  </span><span class="p">|</span><span class="w">  </span><span class="m">51</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-13"><a id="__codelineno-27-13" name="__codelineno-27-13" href="#__codelineno-27-13"></a><span class="w"> </span><span class="m">20250729001157020</span><span class="w">   </span><span class="p">|</span><span class="w"> </span><span class="nv">country</span><span class="o">=</span>IN<span class="w">             </span><span class="p">|</span><span class="w"> </span>c74bc599-44e3-43fd-9851-6ed16c7c0b96-0_1-111-120_20250729001157020.parquet<span class="w"> </span><span class="p">|</span><span class="w"> </span>fa8d99e4-6100-41a1-b2c1-dec3a1688608<span class="w"> </span><span class="p">|</span><span class="w"> </span>user_373<span class="w"> </span><span class="p">|</span><span class="w">  </span><span class="m">45</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>IN<span class="w">      </span>
</span><span id="__span-27-14"><a id="__codelineno-27-14" name="__codelineno-27-14" href="#__codelineno-27-14"></a><span class="o">(</span><span class="m">10</span><span class="w"> </span>rows<span class="o">)</span>
</span></code></pre></div>
<p>Notice that you can see the relevant Hudi metadata information for each row of the data.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: this information is also available for the MoR tables, but we chose to omit it in the previous section for brevity.</p>
</div>
<p>From here, you can experiment with adding data to our partitioned CoW table and exploring how the queries and s3 storage files change. You can also explore more advanced queries of the Hudi metadata on the MoR tables.</p>
<h3 id="shutdown">Shutdown<a class="headerlink" href="#shutdown" title="Permanent link">&para;</a></h3>
<p>When you're all done with the labs, to clean up your environment you can do these steps:</p>
<p>In the <code>spark-shell</code> terminal, to exit the scala prompt, you enter <code>ctrl-c</code></p>
<p>In the <code>presto-cli</code> terminal, to exit the presto prompt, you enter <code>ctrl-d</code></p>
<p>Then, to stop all your running Docker/Podman containers, you issue:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#__codelineno-28-1"></a>docker<span class="w"> </span>compose<span class="w"> </span>down<span class="w"> </span>-v
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note: you need to be in the src or the src/conf folders while issuing the docker compose</p>
</div>
<p>This command will stop all containers and remove the volumes.</p>







  
  






                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
      
      <nav class="md-footer__inner md-grid" aria-label="Footer" >
        
          
          <a href="../lab-2/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Lab 2. Create and Query Basic Hudi Tables">
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                Lab 2. Create and Query Basic Hudi Tables
              </div>
            </div>
          </a>
        
        
          
          <a href="../resources/RESOURCES/" class="md-footer__link md-footer__link--next" aria-label="Next: Additional Resources">
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Additional Resources
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11z"/></svg>
            </div>
          </a>
        
      </nav>
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2023- IBM Developer
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/ibm" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/ibmdeveloper" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M459.4 151.7c.3 4.5.3 9.1.3 13.6 0 138.7-105.6 298.6-298.6 298.6-59.5 0-114.7-17.2-161.1-47.1 8.4 1 16.6 1.3 25.3 1.3 49.1 0 94.2-16.6 130.3-44.8-46.1-1-84.8-31.2-98.1-72.8 6.5 1 13 1.6 19.8 1.6 9.4 0 18.8-1.3 27.6-3.6-48.1-9.7-84.1-52-84.1-103v-1.3c14 7.8 30.2 12.7 47.4 13.3-28.3-18.8-46.8-51-46.8-87.4 0-19.5 5.2-37.4 14.3-53C87.4 130.8 165 172.4 252.1 176.9c-1.6-7.8-2.6-15.9-2.6-24C249.5 95.1 296.3 48 354.4 48c30.2 0 57.5 12.7 76.7 33.1 23.7-4.5 46.5-13.3 66.6-25.3-7.8 24.4-24.4 44.8-46.1 57.8 21.1-2.3 41.6-8.1 60.4-16.2-14.3 20.8-32.2 39.3-52.6 54.3"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.linkedin.com/company/ibm/" target="_blank" rel="noopener" title="www.linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/user/developerworks" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M549.7 124.1c-6.2-23.7-24.8-42.3-48.3-48.6C458.9 64 288.1 64 288.1 64S117.3 64 74.7 75.5c-23.5 6.3-42 24.9-48.3 48.6C15 167 15 256.4 15 256.4s0 89.4 11.4 132.3c6.3 23.6 24.8 41.5 48.3 47.8C117.3 448 288.1 448 288.1 448s170.8 0 213.4-11.5c23.5-6.3 42-24.2 48.3-47.8 11.4-42.9 11.4-132.3 11.4-132.3s0-89.4-11.4-132.3zM232.2 337.6V175.2l142.7 81.2z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://dev.to/ibmdeveloper" target="_blank" rel="noopener" title="dev.to" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.0.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path fill="currentColor" d="M120.1 208.3c-3.9-2.9-7.8-4.3-11.6-4.3H91.1v104.5h17.4c3.9 0 7.8-1.4 11.6-4.3s5.8-7.3 5.8-13.1v-69.7c0-5.8-2-10.2-5.8-13.1M404.1 32H43.9C19.7 32 .1 51.6 0 75.8v360.4C.1 460.4 19.7 480 43.9 480h360.2c24.2 0 43.8-19.6 43.9-43.8V75.8c-.1-24.2-19.7-43.8-43.9-43.8M154.2 291.2c0 18.8-11.6 47.3-48.4 47.3H59.4V173h47.4c35.4 0 47.4 28.5 47.4 47.3zm100.7-88.7h-53.3v38.4h32.6v29.6h-32.6v38.4h53.3v29.6h-62.2c-11.2.3-20.4-8.5-20.7-19.7V193.7c-.3-11.1 8.6-20.4 19.7-20.7h63.2zm103.6 115.3c-13.2 30.7-36.8 24.6-47.4 0L272.6 173h32.6l29.7 113.7L364.5 173h32.6l-38.5 144.8z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "content.code.copy", "content.code.select", "content.code.annotate", "navigation.footer"], "search": "../assets/javascripts/workers/search.d50fe291.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.50899def.min.js"></script>
      
    
  </body>
</html>